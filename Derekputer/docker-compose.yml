services:
  proxy:
    image: node
    container_name: proxy
    restart: always
    network_mode: host
    volumes:
      - /home/derek/proxy-whitelist.json:/whitelist.json
      - /home/derek/proxy-blacklist.json:/blacklist.json
      - /home/derek/proxy-servers.json:/servers.json
      - /home/derek/proxy-config.json:/config.json
    command: bash -c "
      git clone https://github.com/Lyall-A/HTTP-Reverse-Proxy.git /app;
      cd /app;
      git pull;
      git submodule update --init --recursive;
      cp /whitelist.json .;
      cp /blacklist.json .;
      cp /servers.json .;
      cp /config.json .;
      node ."
  octoprint:
    image: octoprint/octoprint
    container_name: octoprint
    restart: always
    ports:
      - 5000:80
    volumes:
      - /home/derek/Docker/octoprint:/octoprint
      - /dev/ttyUSB0:/dev/ttyUSB0
    privileged: true
  derek-cam:
    image: node
    container_name: derek-cam
    restart: always
    ports:
      - 5001:5001
    volumes:
      - /dev/video1:/dev/video1
      - /home/derek/Docker/derek-cam:/app
      - /home/derek/derek-cam-error.jpg:/error.jpg
      - /home/derek/derek-cam-offline.jpg:/offline.jpg
      - /home/derek/derek-cam-config.json:/config.json
    privileged: true
    command: bash -c "
      apt-get update;
      apt-get install -y git ffmpeg;
      apt-get clean;
      git clone https://github.com/Lyall-A/Derek-Cam.git /app;
      cd /app;
      git pull;
      git submodule update --init --recursive;
      cp /error.jpg .;
      cp /offline.jpg .;
      cp /config.json .;
      node ."
  derek-psu:
    image: node
    container_name: derek-psu
    restart: always
    ports:
      - 5002:5002
      - 9999:9999
    volumes:
      - /home/derek/Docker/derek-psu:/app
      - /home/derek/derek-psu-config.json:/config.json
    command: bash -c "
      git clone https://github.com/Lyall-A/Derek-PSU.git /app;
      cd /app;
      git pull;
      git submodule update --init --recursive;
      cp /config.json .;
      node ."